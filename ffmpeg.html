<!DOCTYPE html>
<html class="theme theme-white">
<head>
<meta charset="utf-8">
<title>ffmpeg</title>
<link href="https://www.zybuluo.com/static/assets/template-theme-white.css" rel="stylesheet" media="screen">
<style type="text/css">

#wmd-preview h1  {
    color: #0077bb; /* 将标题改为蓝色 */
}</style>
</head>
<body class="theme theme-white">
<div id="wmd-preview" class="wmd-preview wmd-preview-full-reader"><div class="md-section-divider"></div><div class="md-section-divider"></div><h2 data-anchor-id="ubuw" id="title"> </h2><div class="md-section-divider"></div><h1 data-anchor-id="15nu" id="ffmpeg">ffmpeg</h1><div class="md-section-divider"></div><h3 data-anchor-id="kb52" id="1-如何安装">1. 如何安装</h3><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="zeja"><ol class="linenums"><li class="L0"><code><span class="pln">$ sudo brew install ffmpeg </span><span class="pun">(</span><span class="typ">Mac</span><span class="pln"> OS</span><span class="pun">)</span></code></li><li class="L1"><code><span class="pln">$ sudo apt</span><span class="pun">-</span><span class="kwd">get</span><span class="pln"> install ffmpeg </span><span class="pun">(</span><span class="typ">Ubuntu</span><span class="pun">)</span></code></li></ol></pre><p data-anchor-id="prjb">或者: <a href="https://www.ffmpeg.org/download.html" target="_blank">官网</a>下载源码</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="41pe"><ol class="linenums"><li class="L0"><code class="language-shell"><span class="pln">$ </span><span class="pun">./</span><span class="pln">configure </span><span class="pun">--</span><span class="pln">cc</span><span class="pun">=</span><span class="pln">clang </span><span class="pun">--</span><span class="pln">disable</span><span class="pun">-</span><span class="kwd">asm</span></code></li><li class="L1"><code class="language-shell"><span class="pln">$ make</span></code></li><li class="L2"><code class="language-shell"><span class="pln">$ sudo make install</span></code></li><li class="L3"><code class="language-shell"><span class="pln">$ man ffmpeg</span></code></li></ol></pre><div class="md-section-divider"></div><h3 data-anchor-id="g8jo" id="2视频处理">2.视频处理</h3><blockquote data-anchor-id="3v0a" class="white-blockquote">
  <p>当前所有处理的视频源都为MP4文件(腾讯云互动直播录制的视频),利用ffmpeg进行合并，剪裁，加水印等操作。    </p>
</blockquote><div class="md-section-divider"></div><h5 data-anchor-id="5g43" id="q-如何把文件变成横屏">Q: <strong>如何把文件变成横屏</strong></h5><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="3tcs"><ol class="linenums"><li class="L0"><code class="language-shell"><span class="pln">ffmpeg </span><span class="pun">-</span><span class="pln">i source</span><span class="pun">.</span><span class="pln">mp4 </span><span class="pun">-</span><span class="pln">vf crop</span><span class="pun">=</span><span class="lit">480</span><span class="pun">:</span><span class="lit">320</span><span class="pln"> source_w480_l320</span><span class="pun">.</span><span class="pln">mp4</span></code></li></ol></pre><ul data-anchor-id="stzv">
<li>备注：源文件为640x480,裁剪成320x480效果,画面宽度不变，长度640-&gt;320,居中裁剪。编码的耗时，成功率，视频质量需要进一步验证。</li>
</ul><div class="md-section-divider"></div><h5 data-anchor-id="spxo" id="q如何给视频加片头片尾">Q：<strong>如何给视频加片头片尾</strong></h5><ol data-anchor-id="2rab">
<li>这种方式片头没有声音这个是视频都没有，内容会花屏，录制时长也不对</li>
</ol><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="b98b"><ol class="linenums"><li class="L0"><code><span class="pln">$ vim fileList</span><span class="pun">.</span><span class="pln">txt</span></code></li><li class="L1"><code><span class="pln">  file </span><span class="str">'header.mp4'</span></code></li><li class="L2"><code><span class="pln">  file </span><span class="str">'file.mp4'</span></code></li><li class="L3"><code><span class="pln">  file </span><span class="str">'footer.mp4'</span></code></li><li class="L4"><code><span class="pln">$ ffmpeg </span><span class="pun">-</span><span class="pln">f concat </span><span class="pun">-</span><span class="pln">i fileList</span><span class="pun">.</span><span class="pln">txt </span><span class="pun">-</span><span class="pln">c copy </span><span class="kwd">final</span><span class="pun">.</span><span class="pln">mp4</span></code></li></ol></pre><ol data-anchor-id="uro6">
<li>音轨从头开始同步</li>
</ol><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="k4nj"><ol class="linenums"><li class="L0"><code><span class="pln">$ ffmpeg  </span><span class="pun">-</span><span class="pln">i header</span><span class="pun">.</span><span class="pln">mp4 </span><span class="pun">-</span><span class="pln">i file</span><span class="pun">.</span><span class="pln">mp4 </span><span class="pun">-</span><span class="pln">i footer</span><span class="pun">.</span><span class="pln">mp4 </span><span class="pun">-</span><span class="pln">acodec copy </span><span class="pun">-</span><span class="pln">vcodec copy  </span><span class="kwd">final</span><span class="pun">.</span><span class="pln">mp4</span></code></li></ol></pre><div class="md-section-divider"></div><h4 data-anchor-id="lgdm" id="q-如何给视频加水印">Q: <strong>如何给视频加水印</strong></h4><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="qsfd"><ol class="linenums"><li class="L0"><code class="language-shell"><span class="pln">$ ffmpeg </span><span class="pun">-</span><span class="pln">i watermark</span><span class="pun">.</span><span class="pln">png </span><span class="pun">-</span><span class="pln">vf scale</span><span class="pun">=</span><span class="lit">65</span><span class="pun">:</span><span class="lit">65</span><span class="pln"> water1</span><span class="pun">.</span><span class="pln">png </span><span class="com"># 裁剪图片比例</span></code></li><li class="L1"><code class="language-shell"><span class="pln">$ ffmpeg </span><span class="pun">-</span><span class="pln">y </span><span class="pun">-</span><span class="pln">i </span><span class="lit">200024589</span><span class="pln">_7dc0211dc05e4aa5a653eb6f55a03175</span><span class="pun">.</span><span class="pln">f0</span><span class="pun">.</span><span class="pln">mp4 </span><span class="pun">-</span><span class="pln">i water1</span><span class="pun">.</span><span class="pln">png  </span><span class="pun">-</span><span class="pln">filter_complex </span><span class="str">'overlay=main_w-overlay_w-10:main_h-overlay_h-10'</span><span class="pln"> output</span><span class="pun">.</span><span class="pln">mp4</span></code></li></ol></pre><blockquote data-anchor-id="vzup" class="white-blockquote">
  <p>corp参数参照：<a href="http://stackoverflow.com/questions/10918907/how-to-add-transparent-watermark-in-center-of-a-video-with-ffmpeg" target="_blank">stackoverflow</a></p>
</blockquote><div class="md-section-divider"></div><h4 data-anchor-id="ev80" id="q如何截取mp3">Q:<strong>如何截取mp3</strong></h4><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="15ky"><ol class="linenums"><li class="L0"><code><span class="pln">$ ffmpeg </span><span class="pun">-</span><span class="pln">i split</span><span class="pun">.</span><span class="pln">mp4 </span><span class="pun">-</span><span class="pln">vn </span><span class="pun">-</span><span class="pln">f mp3 audio</span><span class="pun">.</span><span class="pln">mp3</span></code></li></ol></pre><div class="md-section-divider"></div><h4 data-anchor-id="pi1f" id="q如何给实时流加滤镜">Q:<strong>如何给实时流加滤镜</strong></h4><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="pukb"><ol class="linenums"><li class="L0"><code><span class="pln">$ ffmpeg \</span></code></li><li class="L1"><code><span class="pun">-</span><span class="pln">i http</span><span class="pun">:</span><span class="com">//4349.liveplay.myqcloud.com/live/4349_889083.flv \</span></code></li><li class="L2"><code><span class="pun">-</span><span class="pln">i logo</span><span class="pun">.</span><span class="pln">png \</span></code></li><li class="L3"><code><span class="pun">-</span><span class="pln">i logo</span><span class="pun">.</span><span class="pln">png \</span></code></li><li class="L4"><code><span class="pun">-</span><span class="pln">filter_complex </span><span class="str">"overlay=5:5,overlay=x=W-w:y=5"</span><span class="pln"> \</span></code></li><li class="L5"><code><span class="pun">-</span><span class="pln">vcodec libx264 \</span></code></li><li class="L6"><code><span class="pun">-</span><span class="pln">f flv </span><span class="str">"rtmp://4349.livepush.myqcloud.com/live/4349_69c7174378?bizid=4349&amp;txSecret=ec3f7c6bb1d9c92046c897bf44a17a12&amp;txTime=5839B17F"</span></code></li></ol></pre><div class="md-section-divider"></div><h4 data-anchor-id="nlqx" id="q-如何查看文件时长等信息">Q: <strong>如何查看文件时长等信息</strong></h4><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="xcdt"><ol class="linenums"><li class="L0"><code><span class="pln">$ ffmpeg </span><span class="pun">-</span><span class="pln">i </span><span class="lit">1.flv</span></code></li><li class="L1"><code><span class="pln">ffmpeg version </span><span class="lit">3.1</span><span class="pun">.</span><span class="lit">5</span><span class="pln"> </span><span class="typ">Copyright</span><span class="pln"> </span><span class="pun">(</span><span class="pln">c</span><span class="pun">)</span><span class="pln"> </span><span class="lit">2000</span><span class="pun">-</span><span class="lit">2016</span><span class="pln"> the </span><span class="typ">FFmpeg</span><span class="pln"> developers</span></code></li><li class="L2"><code><span class="pln">  built </span><span class="kwd">with</span><span class="pln"> </span><span class="typ">Apple</span><span class="pln"> LLVM version </span><span class="lit">5.1</span><span class="pln"> </span><span class="pun">(</span><span class="pln">clang</span><span class="pun">-</span><span class="lit">503.0</span><span class="pun">.</span><span class="lit">40</span><span class="pun">)</span><span class="pln"> </span><span class="pun">(</span><span class="pln">based on LLVM </span><span class="lit">3.4svn</span><span class="pun">)</span></code></li><li class="L3"><code><span class="pln">  configuration</span><span class="pun">:</span><span class="pln"> </span><span class="pun">--</span><span class="pln">cc</span><span class="pun">=</span><span class="pln">clang </span><span class="pun">--</span><span class="pln">disable</span><span class="pun">-</span><span class="kwd">asm</span></code></li><li class="L4"><code><span class="pln">  libavutil      </span><span class="lit">55.</span><span class="pln"> </span><span class="lit">28.100</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">55.</span><span class="pln"> </span><span class="lit">28.100</span></code></li><li class="L5"><code><span class="pln">  libavcodec     </span><span class="lit">57.</span><span class="pln"> </span><span class="lit">48.101</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">57.</span><span class="pln"> </span><span class="lit">48.101</span></code></li><li class="L6"><code><span class="pln">  libavformat    </span><span class="lit">57.</span><span class="pln"> </span><span class="lit">41.100</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">57.</span><span class="pln"> </span><span class="lit">41.100</span></code></li><li class="L7"><code><span class="pln">  libavdevice    </span><span class="lit">57.</span><span class="pln">  </span><span class="lit">0.101</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">57.</span><span class="pln">  </span><span class="lit">0.101</span></code></li><li class="L8"><code><span class="pln">  libavfilter     </span><span class="lit">6.</span><span class="pln"> </span><span class="lit">47.100</span><span class="pln"> </span><span class="pun">/</span><span class="pln">  </span><span class="lit">6.</span><span class="pln"> </span><span class="lit">47.100</span></code></li><li class="L9"><code><span class="pln">  libswscale      </span><span class="lit">4.</span><span class="pln">  </span><span class="lit">1.100</span><span class="pln"> </span><span class="pun">/</span><span class="pln">  </span><span class="lit">4.</span><span class="pln">  </span><span class="lit">1.100</span></code></li><li class="L0"><code><span class="pln">  libswresample   </span><span class="lit">2.</span><span class="pln">  </span><span class="lit">1.100</span><span class="pln"> </span><span class="pun">/</span><span class="pln">  </span><span class="lit">2.</span><span class="pln">  </span><span class="lit">1.100</span></code></li><li class="L1"><code><span class="pun">[</span><span class="pln">flv </span><span class="pun">@</span><span class="pln"> </span><span class="lit">0x7fbb1b004e00</span><span class="pun">]</span><span class="pln"> video stream discovered after head already parsed</span></code></li><li class="L2"><code><span class="pun">[</span><span class="pln">flv </span><span class="pun">@</span><span class="pln"> </span><span class="lit">0x7fbb1b004e00</span><span class="pun">]</span><span class="pln"> audio stream discovered after head already parsed</span></code></li><li class="L3"><code><span class="typ">Input</span><span class="pln"> </span><span class="com">#0, flv, from '1.flv':</span></code></li><li class="L4"><code><span class="pln">  </span><span class="typ">Metadata</span><span class="pun">:</span></code></li><li class="L5"><code><span class="pln">    encoder         </span><span class="pun">:</span><span class="pln"> </span><span class="typ">Lavf56</span><span class="pun">.</span><span class="lit">40.101</span></code></li><li class="L6"><code><span class="pln">  </span><span class="typ">Duration</span><span class="pun">:</span><span class="pln"> </span><span class="lit">00</span><span class="pun">:</span><span class="lit">30</span><span class="pun">:</span><span class="lit">02.71</span><span class="pun">,</span><span class="pln"> start</span><span class="pun">:</span><span class="pln"> </span><span class="lit">0.110000</span><span class="pun">,</span><span class="pln"> bitrate</span><span class="pun">:</span><span class="pln"> </span><span class="lit">582</span><span class="pln"> kb</span><span class="pun">/</span><span class="pln">s</span></code></li><li class="L7"><code><span class="pln">    </span><span class="typ">Stream</span><span class="pln"> </span><span class="com">#0:0: Video: h264 (High), yuv420p, 368x640, 29.97 tbr, 1k tbn</span></code></li><li class="L8"><code><span class="pln">    </span><span class="typ">Stream</span><span class="pln"> </span><span class="com">#0:1: Audio: aac (LC), 44100 Hz, mono, fltp</span></code></li></ol></pre><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="cc94"><ol class="linenums"><li class="L0"><code><span class="pln">$ ffprobe </span><span class="pun">-</span><span class="pln">show_streams </span><span class="pun">-</span><span class="pln">i </span><span class="lit">1.flv</span></code></li></ol></pre><div class="md-section-divider"></div><h4 data-anchor-id="2zuk" id="q-如何旋转视频">Q: 如何旋转视频</h4><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="9ab6"><ol class="linenums"><li class="L0"><code><span class="pln">$ ffmpeg </span><span class="pun">-</span><span class="pln">i </span><span class="lit">1.mp4</span><span class="pln"> </span><span class="pun">-</span><span class="pln">vf </span><span class="str">"transpose=1"</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">mp4</span></code></li></ol></pre><div class="md-section-divider"></div><h4 data-anchor-id="mdbv" id="q-如何以json格式输出媒体文件信息">Q: 如何以json格式输出媒体文件信息</h4><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="ihe5"><ol class="linenums"><li class="L0"><code><span class="pln">$ ffprobe </span><span class="pun">-</span><span class="pln">v quiet </span><span class="pun">-</span><span class="pln">print_format json </span><span class="pun">-</span><span class="pln">show_format </span><span class="pun">-</span><span class="pln">show_streams input</span><span class="pun">.</span><span class="pln">mp4</span></code></li></ol></pre></div>
</body>
</html>
